---
title: Quantifying interactions between economics of climate change, the rest of economics
  and other disciplines
author: ''
date: today
output:
  pdf_document: default
  html_document:
    css: styles.css
    keep_md: true
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

# Clean memory 
rm(list=ls())
gc()

# Load package
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, data.table, here, lubridate, ggmap, geosphere, stringr, 
               gender, genderdata, stringi, dplyr, tidyr, genderizeR, kableExtra, ggplot2,
               plm, fixest, stargazer, lmtest, modelsummary, tictoc, countries)

# List directories 
dir <- list()
dir$root <- here()
dir$figures <- here(dir$root, "Figures")
dir$tables <- here(dir$root, "Tables")
dir$raw.data <- here(dir$root, "Raw_data")
dir$prep.data <- here(dir$root, "Prepared_data")
# Create non existing directories
lapply(dir, function(i) dir.create(i, recursive = T, showWarnings = F))
```

```{r, echo=FALSE}
#Load data 

# First load data: Corpus_Short
load(here(dir$prep.data, "GenderedAuthors_Data.Rdata"))

#We only work with Corpus.CleanedNames.2
Corpus.Short.Small <- Corpus.CleanedNames.2
Corpus.Short <- Corpus.CleanedNames.2
Corpus.Short.Small.Filt <- Corpus.CleanedNames.2
Corpus.CleanedNames <- Corpus.CleanedNames.2
```

## Introduction

Gender disparities in scientific research remain a pressing issue, with
significant impacts on the balanced development of the field. In particular,
gender role positioning and educational restrictions continue to hinder
equitable progress in scientific research. This study aims to provide a
quantitative analysis of these gender disparities *in economics, with a specific
focus on climate change economics*. The analysis aims at illustrating the gender
gap in authorship in economics, by documenting its evolution through years and
between journals.

Previous research has shown a dominance of male authors in quantity of articles
and influence.  Junwan Liu, Yinglu Song, and Sai Yang (2019), in their paper
"Gender Disparities in the Field of Economics," brings evidence of gender
disparities in economics, while studying their disparities across countries,
institutions, and journal levels. Their findings indicate geographical
variations, and also revealed that the number of articles of both male and
female authors decreases logarithmically with career age, while the influence of
female authors tends to increase with longer careers due to higher
qualifications.

Evidence also suggest that the publication process in economics is not gender
neutral. For instance, David Card, Stefano Della Vigna, Patricia Funk, and
Nagore Iriberri (2019), in their paper "Are Referees and Editors in Economics
Gender Neutral?", examined the role of gender in the evaluation of economic
articles by referees and editors. They don't find any effect of gender on the
referee assessment. However, they highlight that female-authored papers get more
citations than male-authored papers when considering differences in paper
quality and field. Their main explanation is that referees impose higher
standards to women authored articles.

Our research complements this literature using a larger bibliographic dataset,
drawing from Web of Science and Scopus bibliographic databases, which includes
information on more than 1.1 million articles published between 1950 and 2022 in
peer-reviewed economic journals. Our analysis then distinguish articles focusing
on climate-related issues and the rest of articles in economics. We aim at
uncovering whether gender disparities between climate change economics and the
rest of the economic literature is substantial. We also account for differences
across journal levels and collaboration types. <!-- Specifically, we categorize
journals into top five and top thirty tiers and analyze the degree of
mixed-gender collaborations within these articles. --> Our objective is to
validate and extend previous findings within the niche of climate economics,
thereby contributing to the understanding of gender inequalities in this crucial
area of research.

## Data cleaning and gender assignment algorithm

To accurately assess gender disparities in scientific research, we start by
documenting our data preparation process to <!-- obtain the gender of authors of
each articles. a rigorous data cleaning and gender assignment process is
essential. --> <!-- This section outlines the methodology employed to clean the
data set and assign gender probabilities to authors' first names. -->

### Data Preparation

From our corpus of articles from Web of Science and Scopus published in
peer-reviewed journals in English (about 1.1 million articles), we restrict our
sample to articles with at maximum 15 authors, which constitute 99.95% of the
data set. For each article, our database gives us all authors'
full names, names and first names. The first stage of the cleaning process aimed
to homogeneize the character encoding. This step ensures that author full names
and first name has the same character encoding as the list of authors full
names, and the list of first name, that we use to identify gender. The
homogeneization of the character encoding means that for instance we removed
accentuated character. While homogeneizing character encoding, we also removed
other information in the authors variable provided by Scopus and Web of Science,
such as their ORCID or Scopus ID. This requires to remove text in brackets,
extraneous spaces, in particular those at the beginning and end of names and any
letters followed by a period. Also, when creating our first name variable for
authors, we removed isolated/single letters (i.e., we removed the the middle
names of authors), and we only kept the first name when authors had compound
names, as our list of first names used for gender identification does not
contain any compound name. This list is provided by the `gender` package in R.
Altogether, these steps ensure that authors' full names and first names are in a
suitable format for gender identification.

### Algorithm to identify author's gender

<!-- I think we can improve our description of the alogrithm -->

We develop an algorithm to identify gender to each author. The decision steps
are the following. First, we set as `unknown` the gender of every author with
first name within the list of common chinese first name (see [Wikipedia page for
a list of common chinese first
names](https://en.wikipedia.org/wiki/Chinese_given_name), and develop the reason
later). Second, for authors with a non-chinese firstname, we check whether their
full name is in the list of the top 10% of female economists build by REPEC (see
[link here](https://ideas.repec.org/top/top.women.html)). If so, the author is
identified as female, if not we check whether the author's full name is in the
list of the top 10% of male economists of REPEC. If so, the author is identified
as male.
In the case where the author's full name is not in the list of the top 10% lists
of female and male economists, we use the author's first name to identify their
gender. The principle is the following. We use the `gender` package which
provides for a large number of first name, the proportion in a given population
of male and female with the given name. In our analysis, we use this proportion
as a probability that the given author is male or female. The proportion of male
and femae author is retrieved by the `gender` package using the "ssa" method,
which uses data from the US Census List which existing first name in the US the
proportion of male and female. We complement this approach with the "napp"
method, which adds gender probabilities for first names not identified by the
"ssa" method (which are mostly nordic and german first names).
Thus, for each author's first name for which we have a gender proportion using
the `gender` package we assign them to a gender if the gender proportion of
their first name is above 90%. When the proportion is below, we classify their
first name as `unknown`, and if we don't have gender proportion associated to
their first name, we set their gender as missing.

As a summary, our gender variable can take five values: NA, unknown, male,
female or undecided. The gender is missing if the author's first name is not
referenced in the list of first names of the `gender`package. The gender is
unknown if the author's first name is a common chinese first name. The gender is
undecided when the the probability of the first name to be male is between 10%
and 90%. The gender is male if the author full name is in the list of the top
10% of male economists, or when its first name has a proportion to be male
larger than 90% according to the `gender` package. The gender is female when the
author's full name is in the list of the top 10% of female economists or when
the first name has a proportion to be male smaller than 10% according to the
`gender` package.

Additionally, the algorithm created variables indicating the probability of each
first name being male or female, only if gender is assigned. These variables are
varying between 0 and 1 or take value NA. On aggregate, to count authors by
gender, we sum this probability to account for the fact that our gender
identification strategy contains some approximation.

This comprehensive algorithm limits mistakes in our gender assignment to each
author. <!-- facilitating a detailed analysis of gender disparities in the field
of climate economics. --> Note that the proportion of male and female having a
given first name can vary according to the population/culture, and to the
cohort/date of birth of the population. Indeed, a given name can see its gender
attribution vary over the long term.



<!-- As for the gender variable, the algorithm first treat full names for each
author and then first names. --> <!-- If the full name is missing from our
initial data base, both probabilities are set to NA. --> <!-- If the full name
is is the list of top 10% of female economists, the probability for the first
name to be female is set to 1 and 0 for male. --> <!-- Reciprocally, if the full
name is in the list of top 10% of male economists, the probability for the first
name to be female is set to 0 and 1 for male. --> <!-- Then, we treat first name
for each author in the algorithm to define probabilities gender. --> <!-- If a
first name is missing from our initial data base, both probabilities were set to
NA. --> <!-- If a first name appeared on the list of common Chinese names, both
probabilities were also set to NA. --> <!-- If first name is absent from the
list of first names with measured gender probability (absent from the data frame
that we created during the previous step), both probabilities were set to NA.
--> <!-- If the first name was found and recognized as "male" or "female," the
respective probabilities were assigned accordingly from the data frame assigning
gender probabilities. -->



### Creation of variables of interest: proportion of male and female authors and gender type of co-authorship

Using our gender probability variable for each author, we are able to calculate
the proportion of male and female authors at the article level. To do so, we sum
the probability of female and male of each author of the article. We divide this
sum by the number of authors with an identified gender, so that we get the
percentage of female authors and male authors (among authors with identified
gender) in the article.

Finally, we create a categorical variable to document the gender arrangement of
co-authorship. The five categories are the following:
- "F" if there is only one author in the article and if this author has a female gender,
- "M" if there is only one author and if this author has a male gender,
- "MM" if there is more than 1 author and if these authors are only male,
- "FF" if there is more than 1 author and if these authors are only female,
- and finally "MF" if there is more than 1 author and if these authors are both male and female.
These variables are later used for the computation of descriptive statistics and
further data analysis.

### Assessing the quality of our gender identification algorithm 

Having cleaned up the data and created our algorithm for assigning a gender to
each existing first name, we here propose a quality assessment of the algorithm.
How well are we assigning gender to our authors in the corpus?

#### Comparison between total number of first names and first names with assigned gender before the use of an assignation gender algorithm

First and before constructing our algorithm, we can compare the total number of
unique first names in our database with the total number of first names that can
be assigned to a gender using the "ssa" and "napp" method of the `gender`
package. This gives us an idea on the number of first names for which we can
assign a gender proportion.

```{r, echo=FALSE, include=TRUE}
all_names_incorpus <- unlist(Corpus.CleanedNames[, grepl("^f_name_", colnames(Corpus.CleanedNames))]) %>% 
  unique() # Vecteur qui contient tous les prénoms différents dans le corpus
length(all_names_incorpus)
```
We have 95,589 unique first names in our database. The total number of first
names that can be assigned to a gender thanks to the "ssa" and "napp" method is
24 142. Therefore, we have about 75% of first names whose gender which could not
be determined only using the SSA and NAPP methods, and which will not be
recognized by these methods. This can seem an important proportion of first name
for which we cannot assign gender. But remember that for some of the authors,
the gender identification is made using the list of top 10% of economists, and
that it is likely that some of the unique first names for which there is no
equivalent in the `gender` package, it is likely that it is relative rare first
name (that does not concern many of our 1.1 million articles).

Having a deeper look on those first names not referenced in the `gender`
package, they appear to come from non-Western cultures. These first names are
fairly rare and do not recur regularly in the articles, so they have little
effect on matching [It would be good to check how many articles have these first
names]. However, this is an important limitation in that we are not able to
assign a gender probability to a significant part of the worldwide population of
economists. Our gender identification is thus not performant regarding
non-Western authors and therefore introduces a significant selection bias.
<!-- Already said so I remove: However, the construction of the algorithm as we did and especially the use of lists for top 10 male and female economists will help us to identify correctly a large part of those unidentified gender. -->

#### Analysis of gender identification at the article level

```{r}
summary(Corpus.CleanedNames.2$ratio_identified_gender)
```
In average, an article has 59% of its author with an identified gender. The
median tells us that at least 50% of the articles have 75% of their authors with
an identified gender.


##### Checking the gender identification by number of authors

Getting deeper into our quality check, we can look at the percentage of authors
with identified gender at the article level, while classifying articles by their
number of authors:

```{r, echo=FALSE, include=TRUE}
ratio_by_nbauthours <- Corpus.CleanedNames.2 %>% 
  group_by(nb_authors) %>% 
  summarize(
    nb_article = n(),
    mean_ratio = mean(ratio_identified_gender, na.rm = T),
    med_ratio = median(ratio_identified_gender)
    )
ratio_by_nbauthours %>%  
  kbl(digits = 3) %>%
  kable_classic_2(full_width = F, html_font = "helvetica")
```

The results show descriptive statistics for the ratio of authors with an
identified gender among the total number of authors for articles, grouped by
number of authors. There are almost 200,000 articles with exactly 3 authors, 64%
of their authors are identified, and more than 50% of these articles have 2 of
these 3 authorsr that have an identified gender. This table show that the
average proportion of authors with an identified gender inreases slightly as the
number of authors per article increases For example, articles with a single
author have an average of 0.5611 authors with identified gender among the total
number of authors, while those with fifteen authors have a higher average of
0.651. Regarding the median of the ratios, it decreases with the number of
authors per article.
<!-- I drop this as I think it is unnecessarily complex: For instance, articles
with one author have a median of 1.0000, indicating that more than/at least 50%
of articles with one author have an identified genre, while this median
proportion decreases as the number of authors increases to reach 0.8 for
articles with fifteen authors. --> <!-- Overall, these trends suggest that in
articles with a greater number of authors, it is less likely that all authors
have an identified gender, which could be due to greater diversity or less
complete author information. -->
<!-- Commentaire: interprétation générale = baisse de la médiane mais la moyenne
augmente donc donne des résultats différents - pas sûre de l'interprétation
finale et de ce que l'on doit privilégier en termes d'analyse (la moyenne ou la
médiane).  -->

#### Checking the algorithm at the author level

We can investigate the quality of the algorithm by looking at each author
individually in our bibliographic database. We thus consider a unique author in
our database when it has a unique full name. Note that potential homonyms are
thus considered as the same authors. On the other hand, a same author but with
different possible spelling of its full name will be considered as a different
author (for instance, one article can give its full name with its middle name,
while other articles may not). The number of authors for which the gender is
missing is the following:


```{r, echo=FALSE, include=TRUE}
table(is.na(authors_df$gender))
```

The table shows statistics on the gender assignment of authors based on the
number of articles they have written. Out of a total of 827,219 authors, around
6.4% (52,904) have missing genders, regardless of the number of articles they
have written. Such authors are ones with missing first names, or a first name
composed of a single letter (as we cannot identify them at all). We can then
look at the number of authors by categories of the gender variable:
```{r, echo=FALSE, include=TRUE}
table(authors_df$gender, useNA = "ifany")
```

Of these, 20.9% (172,987) authors are identified as women, 35.9% (297,279) as
men, (4.4% ) 36,540 have an undetermined gender (first name probability between
10% and 90%), and 32.3% (267,509) have an unknown gender (either a common
chinese first name, or a unreferenced first name in the `gender` package).

A significant proportion of authors therefore have an undecided or unknown
gender, due to the large proportion of non-Western first names that we did not
manage to assign. In particular, we notice several authors with more than 10
articles are East Asian names, which may explain these figures and difficulties
in correctly assigning gender due to the diversity of names and gender
conventions in this region. See for example:

```{r, echo=FALSE, include=TRUE}
# Check authors that have written more than 10 articles:
authors_with10articlesormore <- authors_df %>% 
  filter(n_articles>9)
head(authors_with10articlesormore) %>%  
  kbl(digits = 3) %>%
  kable_classic_2(full_width = F, html_font = "helvetica")
```

At a more detailed level, we have the following number of authors in each gender
category, by number of articles written:

```{r}
# By number of articles written for each author, how much missing gender?
quantile(authors_df$n_articles, probs = c(0.1,0.5,0.66,0.75,0.8,0.9,0.95))
temp_df <- authors_df %>% 
  mutate(article_quantity = case_when(n_articles == 1 ~ "1 article",
                                      n_articles == 2 ~ "2 articles",
                                      n_articles == 3 ~ "3 articles",
                                      n_articles %in% c(4:6)  ~ "4 to 6 articles",
                                      n_articles %in% c(7:10) ~ "7 to 10 articles",
                                      n_articles %in% c(11:20) ~ "11 to 20 articles",
                                      n_articles > 20 ~ "more than 20 articles"),
         article_quantity = factor(article_quantity))
current_levels <- levels(temp_df$article_quantity)
# Rearrange the levels
new_levels <- c(current_levels[1], current_levels[3], current_levels[4], current_levels[5], current_levels[6], current_levels[2], current_levels[7])
# table(authors_df$n_articles, authors_df$gender, useNA="ifany")
# table(temp_df$article_quantity, authors_df$gender, useNA="ifany")
# table(temp_df$n_articles)

temp_df %>% 
  mutate(article_quantity = factor(article_quantity, levels = new_levels)) %>% 
  group_by(article_quantity) %>% 
  summarize(n_authors = length(fullname),
            # n_female = length(fullname[(!is.na(gender)) & gender == "female"]),
            # n_male = length(fullname[(!is.na(gender)) & gender == "male"]),
            n_identified = length(fullname[(!is.na(gender)) & gender %in% c("male", "female")]),
            percent_identified = n_identified / n_authors,
            # n_undecided = length(fullname[(!is.na(gender)) & gender == "undecided"]),
            # n_unknown = length(fullname[(!is.na(gender)) & gender == "unknown"]),
            # n_NA = length(fullname[is.na(gender)]),
            n_unidentified = length(fullname[is.na(gender)]) + length(fullname[(!is.na(gender)) & gender %in% c("undecided", "unknown")]),
            percent_unidentified = n_unidentified / n_authors) %>%  
  kbl(digits = 3) %>%
  kable_classic_2(full_width = F, html_font = "helvetica")
# table(authors_df$n_articles, authors_df$gender, useNA = "ifany")
# Alternative: interprétation en pourcentage, et regrouper par décile. 
```


We notice that our algorithm is better able to assign a gender to author that
have written more articles than author with a few number of articles. Among
authors with 11 articles or more, we're able to identify gender for 2 out of
three of them, while for authors with 1, 2 or 3 articles written, we can only
identify the gender for slightly more than 55% of them. Therefore, as the number
of articles written by an author increases, our algorithm is better able to
assign gender. This is partly due to the fact that we use the ranking of 10%
male and female economists, who are researchers that tend to have written more
than 10 articles in their carreer.

<!-- This was the previous paragraph, but I think our interpretation was erroenous: Examining authors' gender assignment by number of articles written, we find that the percentage of authors with unassigned genders increases slightly with the number of articles written, suggesting that prolific authors are more likely to have names unrecognized by gender algorithms and highlighting the challenges associated with gender assignment in diverse cultural contexts. -->
<!-- For instance, among authors, 501 694 have written only 1 article, 44.3% (36 326 + 21 058 + 165 074/501 694) have an "undetermined", "unknown" or complete unassigned gender, while among the authors that have written that have written 273, 292 or 343 articles, 100% have a complete unassigned gender. -->

<!-- Commentaire: l'interprétation n'est pas forcément évidente. -->
<!-- Ne faudrait-il pas rajouter à ce tableau deux colonnes : une qui compte le nombre d'auteurs qui ont écrit x articles et une qui compte la proportion de «undetermined», «unknown» et «NA» sur le nombre d'auteurs qui ont écrit x articles ? -->
<!-- Cela permettrait une analyse beaucoup plus simple car à vue d'oeil ce n'est pas sur que l'interprétation soit correcte. Je propose une modification pour prendre en compte cela -->

#### Analysis of gender identification at article level

It is also possible to study our gender identification at the article level. Our
articles can have from 1 to 15 authors. We can count the number of authors by
articles, and in particular the number of authors for whom we identify any
gender according to our algorithm. We can then measure the share of authors with
an identified gender at the article level. The following table documents the
quantiles of this share among all articles:

```{r, echo=FALSE, include=TRUE}
Gender_of_Articles <- Corpus.CleanedNames.2 %>% 
  summarize(Nb_articles = length(ratio_identified_gender), # Nb total d'article
            Mean_IdentifiedGender = mean(ratio_identified_gender), # Moyenne du ratio d'auteurs identifé
            Median_identifiedGender = median(ratio_identified_gender), # Médiane
            NoGender = length(ratio_identified_gender[is.na(ratio_identified_gender) | ratio_identified_gender == 0]) / Nb_articles, # Ratio d'articles avec aucun auteur dont le genre est identifié ou NA # Ratio d'article avec aucun auteur dont le genre est identifié : raouter valeurs manuntes
            AllGender = length(ratio_identified_gender[(!is.na(ratio_identified_gender)) & ratio_identified_gender == 1])/Nb_articles, # Ratio d'article où tous les auteurs sont identifiés
            Gender_Larger0.5 = length(ratio_identified_gender[(!is.na(ratio_identified_gender)) & ratio_identified_gender >= 0.5])/Nb_articles, # Ratio d'article où au moins 50% des auteurs sont identifiés
            Gender_Larger0.9 = length(ratio_identified_gender[(!is.na(ratio_identified_gender)) & ratio_identified_gender >= 0.9])/Nb_articles, # Ratio d'article où au moins 90% des auteurs sont identifiés
            Gender_Larger0.25 = length(ratio_identified_gender[(!is.na(ratio_identified_gender)) & ratio_identified_gender >= 0.25])/Nb_articles, # Ratio d'article où au moins 25% des auteurs sont identifiés

            )

Gender_of_Articles %>%  
  t() %>% 
  kbl(digits = 3) %>%
  kable_classic_2(full_width = F, html_font = "helvetica")
```
<!-- I remove the expression "correctly identified", as we don't know if it is correctly identifiy, but rather we identify a gender or not -->
Around 30% of articles have zero author with an identified gender. This illustrates
the limits of our method to identify author's gender. On the other hand, for 48%
of articles, the gender of all authors is identified. Therefore, there is half
of our corpus for which all genders of authors can be identified. For around 65% of articles,
we are able to identify gender to at least half of the article's authors. This shows
that most articles have at least partial gender identification among their
authors. In addition, for about 69% of our articles, we identify the gender of
at least 25% of their authors. Finally, for less than half of the articles, we
identify the gender of 90% of their authors. <!-- This high proportion reflects
almost complete gender identification for a significant proportion of articles,
illustrating the effectiveness of the algorithms or methods used for gender
assignment. --> Finally, this figure indicates that, even in the most difficult
cases, it is still possible to determine the gender of a proportion of authors,
which may be sufficient for certain statistical analyses.

## Descriptive statistics and data analysis

The following analysis on the gender of authors of peer-reviewed articles in
economics will focus on the subsample of articles for which we are able to
identify the gender of at least one author. This is the case for 70% of the
articles of our full bibliographic sample.

```{r, echo=FALSE}
OneGender_by_Articles <- Corpus.CleanedNames.2 %>% 
  summarize(Nb_articles = length(ratio_identified_gender), # Nb total d'article
            No_Author_Gendered = length(ratio_identified_gender[is.na(ratio_identified_gender) | ratio_identified_gender == 0]) / Nb_articles,
            AtLeast_OneAuthor_Gendered = length(ratio_identified_gender[(!is.na(ratio_identified_gender)) & ratio_identified_gender > 0]) / Nb_articles)

OneGender_by_Articles %>% 
  kbl(digits = 3) %>%
  kable_classic_2(full_width = F, html_font = "helvetica")
```

Note that among the 29.9% articles excluded in this analysis, most of them are written by non-western authors. 

### Aggregate share of male and female authors 

For a given article, we measure the share of female authors and the share of
male authors as follows. For female (male), we sum the probability of an author
to be a female (male) among all article's authors, and we divide this number by
the total number of authors with an identified gender. The table below presents
some summary statistics of the share of female and male authors in our corpus:

```{r, echo=FALSE, include=TRUE}

# Calcul des statistiques descriptives
# stats_proportion_female_all <- summary(Corpus.CleanedNames.2$proportion_gender_female_all)
# stats_proportion_female_id <- summary(Corpus.CleanedNames.2$proportion_gender_female_id)
# stats_sum_gender_female <- summary(Corpus.CleanedNames.2$sum_gender_female)
# stats_sum_gender_male <- summary(Corpus.CleanedNames.2$sum_gender_male)
# stats_proportion_male_all <- summary(Corpus.CleanedNames.2$proportion_gender_male_all)
# stats_proportion_male_id <- summary(Corpus.CleanedNames.2$proportion_gender_male_id)

# Extraire les valeurs des statistiques descriptives
# extract_summary <- function(summary_obj) {
#   c(summary_obj["Min."], summary_obj["1st Qu."], summary_obj["Median"], summary_obj["Mean"], summary_obj["3rd Qu."], summary_obj["Max."])
# }

# Créer un tableau de données avec les valeurs extraites
# results_table <- data.frame(
#   Statistic = c("Min", "1st Qu.", "Median", "Mean", "3rd Qu.", "Max"),
#   # Proportion_Female_All = extract_summary(stats_proportion_female_all),
#   Proportion_Female_Id = extract_summary(stats_proportion_female_id),
#   # Sum_Gender_Female = extract_summary(stats_sum_gender_female),
#   # Sum_Gender_Male = extract_summary(stats_sum_gender_male),
#   # Proportion_Male_All = extract_summary(stats_proportion_male_all),
#   Proportion_Male_Id = extract_summary(stats_proportion_male_id)
# )

#amélioration de ton code pour faire un tableau unique 
# I want to change, to only make the descriptive statistics on the 'id' variable, and to give as well the number of articles in the sample
results_table <- Corpus.CleanedNames.2 %>% 
  filter(!is.na(proportion_gender_male_id), ! is.na(ratio_identified_gender) , ratio_identified_gender !=0 )%>% # Keeping our subsample to articles with at least one author gendered
    summarise(
    ShareFemale_mean = mean(proportion_gender_female_id, na.rm = TRUE),
    ShareFemale_min = quantile(proportion_gender_female_id, 0, na.rm = TRUE),
    ShareFemale_25 = quantile(proportion_gender_female_id, 0.25, na.rm = TRUE),
    ShareFemale_median = median(proportion_gender_female_id, na.rm = TRUE),
    ShareFemale_75 = quantile(proportion_gender_female_id, 0.75, na.rm = TRUE),
    ShareFemale_max = quantile(proportion_gender_female_id, 1, na.rm = TRUE),
    ShareMale_mean = mean(proportion_gender_male_id, na.rm = TRUE),
    ShareMale_min = quantile(proportion_gender_male_id, 0, na.rm = TRUE),
    ShareMale_25 = quantile(proportion_gender_male_id, 0.25, na.rm = TRUE),
    ShareMale_median = median(proportion_gender_male_id, na.rm = TRUE),
    ShareMale_75 = quantile(proportion_gender_male_id, 0.75, na.rm = TRUE),
    ShareMale_max = quantile(proportion_gender_male_id, 1, na.rm = TRUE)
  )

# Convert wide data to long format
long_format <- results_table %>%
  pivot_longer(cols = everything(), names_to = c(".value", "variable"), names_pattern = "(.*)_(.*)")

long_format %>% 
  kbl(digits = 3) %>%
  kable_classic_2(full_width = F, html_font = "helvetica")

```

In average, an article has 75% of its authors who are male authors and 25% who
are female female authors. But this average perspective masks the idea that most
articles have no female author. Indeed, more than half of the articles have no
female authors, since the median of the share of female author is almost equal
to zero. This reveals a notable under-representation of women among authors of
academic articles in economics. These results highlight the need for continued
efforts to encourage and support women's participation in the academic field.
The histograms of these variables below complete this description:

```{r, echo=FALSE, include=TRUE}
hist(Corpus.CleanedNames.2$proportion_gender_male_id, main="Distribution of the proportion of men authors by articles", xlab="Proportion of men", col="blue", breaks=20)
hist(Corpus.CleanedNames.2$proportion_gender_female_id, main="Distribution of the proportion of women authors by articles", xlab="Proportion of women", col="pink", breaks=20)
```

The graphs above illustrate the distributions of the male and female
proportions. The histogram of the proportion of male authors shows a very large
number of articles written only by male (the highest bar on the histogram is
close to one). The histogram of the proportion of female authors reveals a
symmetric distribution: there is a vast majority of articles without women
authors. There is a similar number of articles written by female-author only than written in
co-authorship with male authors (the height of the bar on the right, above the 1
value, is of similar height as the cumulated height of all the bars between 0.2
and 0.8). A comparison of these two distributions reveals a significant
under-representation of women among authors of academic articles. While the
proportion of men tends to be high in many articles, that of women remains low
in the majority of cases. These observations are consistent with previous
findings in the literature, underlining the need for ongoing efforts to balance
gender representation in academia. The disparity observed in the distributions
calls for reflection on the factors contributing to this inequality, and the
development of strategies to promote greater inclusion of women in scientific
research.

### Proportion of female and male authors according to different type of collaboration

<!-- I'm not sure that this analysis is very informative as such. I would suggest to rather compute the share of articles in each category? This would inform the reader about the quantity of articles in each category overall. As here, we basically say that female authors only have almost 100% of female authors, male-female articles have almost 50% female authors -> which is a by-product of our gender category variable -->

```{r, echo=FALSE, include=TRUE}
stats_by_category <- Corpus.CleanedNames.2 %>%
  group_by(category_gender) %>%
  summarize(
    Mean_Proportion_Female_Id = mean(proportion_gender_female_id, na.rm = TRUE),
    Median_Proportion_Female_Id = median(proportion_gender_female_id, na.rm = TRUE),
    Mean_Proportion_Male_Id = mean(proportion_gender_male_id, na.rm = TRUE),
    Median_Proportion_Male_Id = median(proportion_gender_male_id, na.rm = TRUE),
  )
stats_by_category
```

```{r, echo=FALSE, include=TRUE}
stats_long <- stats_by_category %>%
  pivot_longer(cols = c(Mean_Proportion_Female_Id, Mean_Proportion_Male_Id), #colonne que l'on veut mettre en format long = moyennes
               names_to = "Gender", #nouvelle colonne intitulée "Gender"
               values_to = "Proportion") %>% #valeurs dans une nouvelle colonne intitulée "Proportion"
  mutate(Gender = ifelse(Gender == "Mean_Proportion_Female_Id", "Female", "Male")) #Si Gender est égal à "Mean_Proportion_Female_Id", alors nous remplaçons cette valeur par "Female". Si Gender est égal à "Mean_Proportion_Male_Id", alors nous remplaçons cette valeur par "Male".

# Créer le graphique
ggplot(stats_long, aes(x = category_gender, y = Proportion, fill = Gender)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Proportion of Female and Male Authors According to Categorical Variables",
       x = "Gender Category",
       y = "Mean Proportion",
       fill = "Gender") +
  theme_minimal()
```

This section presents an analysis of collaboration categories within academic research according to author gender.
Descriptive statistics include the mean and median proportion of female and male authors assigned per category.

Let's focus on the "MF" category, which represents articles written by authors of both genders.
The average proportion of female authors in this category is around 46.36%, while the average proportion of male authors is slightly higher, at around 53.64%.
This near-equality of proportions indicates a remarkable gender parity in mixed collaborations.
Unlike the "F" and "FF" categories, where women are almost exclusively the sole authors, or the "M" and "MM" categories, where men strongly dominate, the "MF" category shows a more balanced distribution.

This is a significant result, as it underlines the importance of mixed collaborations in achieving a more balanced gender representation in academic research.
The almost equal presence of men and women in mixed collaborations may reflect a more inclusive and diversified work dynamic.
This parity in proportions could foster a research environment where the ideas and perspectives of both genders are better represented and integrated.
Promoting this type of collaboration could be an effective way of reducing gender inequalities in academia.
Policies and initiatives to encourage mixed-gender collaborations could thus play a crucial role in advancing gender equity in science and research.

**Alternative:** Articles can be categorized according to whether authors are
written only by a single male or female authors, or by a collaboration of
female-only, male-only or a mixed-gender collaboration. The following table
computes the quantity of articles in each category:

```{r}
share_gender_category <- Corpus.CleanedNames.2 %>% 
  filter(!is.na(category_gender)) %>% 
  group_by(category_gender) %>% 
  summarize(number_articles = n(),
            share_articles = number_articles / length(Corpus.CleanedNames.2$TI[!is.na(Corpus.CleanedNames.2$category_gender)]))

share_gender_category %>% 
  t() %>% 
  kbl(digits = 3) %>%
  kable_classic_2(full_width = F, html_font = "helvetica")
```

Among the 62.8% of articles with authors having an identified gender which are
only written by male, 38% are written by a single author and 24.6% are written
by multiple male authors. Among articles with at least one female author
(37.2%), the share of single-authored paper is substantially larger (11.1%) than
the share of multiple female author articles (4%). In addition, when female
write articles, it tends to be even more often in collaboration with male, as
the share of articles co-authored by male and female authors is 22.1%.

### Overall Temporal evolution

The figure below documents the evolution of the average share of male and female authors
by year:

```{r, echo=FALSE, include=TRUE}
annual_stats <- Corpus.CleanedNames.2 %>%
  group_by(PY) %>%
  summarize(
    Mean_Proportion_Female_Id = mean(proportion_gender_female_id, na.rm = TRUE),
    Mean_Proportion_Male_Id = mean(proportion_gender_male_id, na.rm = TRUE)
  )
# annual_stats

annual_stats_long <- annual_stats %>%
  pivot_longer(
    cols = c(Mean_Proportion_Female_Id, Mean_Proportion_Male_Id),
    names_to = "Gender",
    values_to = "Proportion"
  ) %>%
  mutate(Gender = ifelse(Gender == "Mean_Proportion_Female_Id", "Female", "Male"))

# Créer le graphique
ggplot(annual_stats_long, aes(x = PY, y = Proportion, color = Gender)) +
  geom_line(linewidth = 1) +
  labs(title = "Evolution of Gender Proportions Over Time",
       x = "Publication Year",
       y = "Mean Proportion",
       color = "Gender") +
  theme_minimal()
```

```{r, echo=FALSE, include=TRUE}

```

This section presents the evolution of the average proportion of female and male
authors in academic publications, from 1950 to 2023. It reveals significant
trends over several decades, highlighting gender dynamics in academic research.
From 1950 to 1970, the average proportion of female authors remained remarkably
low, hovering around 0.06. During this period, male authors largely dominated
publications, with proportions approaching 0.94. This disparity underlines the
predominance of men in the academic field at the time.

Between 1970 and 1990, a slight increase in the proportion of female authors was
observed, rising from around 0.12 to 0.15. This period marks the beginning of a
gradual change, although men continue to represent a substantial majority.The
increase remains modest, but indicates a trend towards gender diversification
among academic authors.

From the 1990s onwards, the average proportion of female authors began to rise
more significantly. By 1995, this proportion had risen to around 0.18,
indicating greater inclusion of women in academic publications. This trend has
continued steadily, with the proportion reaching around 0.30 in 2017. At the
same time, the average proportion of male authors is gradually decreasing, but
remains dominant.

Since 2017, the average proportion of female authors has exceeded 0.30, reaching
0.32 in 2020. This growth indicates increasing gender parity, although men
continue to constitute a relative majority with an average proportion around
0.68. Recent years have seen a stabilization of these proportions, with slight
fluctuations.

In conclusion, this section illustrates a positive trend towards greater
inclusion of women in academic research over the decades. Although men are still
in the majority, the continuing growth in the proportion of female authors bears
witness to a gradual shift towards more balanced gender representation in
scientific publications.

### Temporal evolution according to the gender type of co-authorship

<!-- Same comment as before: it is more relevant to study the categorical variables by counting their occcurences, than by counting the mean value of the share of male and female in each category. I propose an alternative table and figure below. -->

```{r, echo=FALSE, include=FALSE}
# Calculer les moyennes annuelles des proportions de genres par catégorie de genre
# Calculer les moyennes annuelles des proportions de genres par catégorie de genre
annual_stats_by_category <- Corpus.CleanedNames.2 %>%
  group_by(PY, category_gender) %>%
  summarize(
    Mean_Proportion_Female_Id = mean(proportion_gender_female_id, na.rm = TRUE),
    Mean_Proportion_Male_Id = mean(proportion_gender_male_id, na.rm = TRUE),
    .groups = 'drop' #`summarise()` has grouped output by 'PY'. You can override using the `.groups` argument.
  )

annual_stats_by_category
```

```{r, echo=FALSE, include=FALSE}
# Restructurer les données pour ggplot2
annual_stats_by_category_long <- annual_stats_by_category %>%
  pivot_longer(
    cols = c(Mean_Proportion_Female_Id, Mean_Proportion_Male_Id),
    names_to = "Gender",
    values_to = "Proportion"
  ) %>%
  mutate(Gender = ifelse(Gender == "Mean_Proportion_Female_Id", "Female", "Male"))

# Créer le graphique
ggplot(annual_stats_by_category_long, aes(x = PY, y = Proportion, color = Gender)) +
  geom_line(size = 1) +
  facet_wrap(~ category_gender) +
  labs(title = "Evolution of Gender Proportions Over Time by Category",
       x = "Publication Year",
       y = "Mean Proportion",
       color = "Gender") +
  theme_minimal()
```

This section provides an analysis of the evolution of average author proportions by gender from 1950 to 2023, and highlights significant dynamics in academic collaborations.

Analysis of gender proportions in mixed collaborations (MF) from 1950 to 2023 reveals that in 1950, female authors represented an average of 37% of mixed teams, compared with 63% for male authors.
This male dominance persisted until the 1960s.
In the 1970s, the average proportion of female authors reached 48%, marking progress towards greater integration of women.
From the 2000s onwards, the proportion of women authors continued to rise, although at just under 46%, reflecting a positive trend towards greater parity.

The data thus show a gradual integration of women into mixed collaborations, indicating steady progress towards gender parity in academic research, despite the persistence of a slight male majority.

```{r, echo=FALSE, include=TRUE}
annual_stats_by_category <- Corpus.CleanedNames.2 %>%
  filter(!is.na(category_gender)) %>% 
  ungroup() %>% 
  group_by(PY) %>% 
  mutate(n_articles_by_year = length(TI)) %>% 
  ungroup() %>% 
  group_by(PY, category_gender) %>%
  summarize(
    count_year_gendercat = length(TI), 
    perc = length(TI) / n_articles_by_year * 100
  ) %>% 
  group_by(PY, category_gender) %>% 
  slice(1)

# Créer le graphique
ggplot(annual_stats_by_category, aes(x = PY, y = perc, color = category_gender)) +
  geom_line() +
  geom_point() +
  labs(title = "Evolution of the gender type of co-authorship",
       x = "Publication Year",
       y = "Share of articles",
       color = "Gender") +
  theme_minimal()
```
Changes a bit the interpretations: important rise of mixed-gender coauthorship, important decrease in the share of articles written by single male authors, stable share of female-only articles.

<!-- -> you actually did this just below. I thus adjust. I think you can refresh your interpretations, especially to the idea that we kow look at the share of articles in each category by year (and not anymore the total count of articles) -->

Analysis of data on the number of articles by gender category from 1950 to 2021
reveals some interesting, albeit nuanced, trends. In 1950, the "M" category
(exclusively male) dominated, with 491 articles. The "F" (all-female) and "MF"
(mixed) categories accounted for 27 and 12 items respectively.
In subsequent years, trends changed significantly. For example, in 1960,
although the "M" category remained dominant with 381 items, the "F" and "MM"
categories showed an increase compared to 1950. However, missing data also began
to appear more pronounced.
The 1970s mark a notable change, with a significant increase in the number of
articles in all categories, including a notable rise in missing data. The "F"
category began to show gradual growth, reaching 130 articles in 1970.
From the 2000s onwards, all categories see a marked increase in the number of
articles, reflecting a global expansion of academic research. The "MF" (mixed
collaboration) category grows particularly rapidly, peaking in 2021 with 16,267
articles, but missing data also increases drastically.
In conclusion, these data illustrate not only the quantitative expansion of
scientific research over the decades, but also changes in the gendered
composition of research teams, with a significant increase in mixed
collaboration. However, it is crucial to take into account the impact of missing
data, which can influence the interpretation of these upward trends.

### Investigating a differentiated place of female authors in the climate economics literature
#### Analysis of articles on climate change at an aggregate level

```{r, echo=FALSE, include=TRUE}
# Calculer les statistiques descriptives pour chaque catégorie de la variable binaire "CC"
stats_by_CC <- Corpus.CleanedNames.2 %>%
  group_by(CC) %>%
  summarize(
    Mean_Proportion_Female_Id = mean(proportion_gender_female_id, na.rm = TRUE),
    Median_Proportion_Female_Id = median(proportion_gender_female_id, na.rm = TRUE),
    Mean_Proportion_Male_Id = mean(proportion_gender_male_id, na.rm = TRUE),
    Median_Proportion_Male_Id = median(proportion_gender_male_id, na.rm = TRUE)
  )


# Conversion en format long
stats_long <- stats_by_CC %>%
  pivot_longer(cols = c(Mean_Proportion_Female_Id, Mean_Proportion_Male_Id),
               names_to = "Gender",
               values_to = "Proportion")

ggplot(stats_long, aes(x = factor(CC), y = Proportion, fill = Gender)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Proportion of Female and Male Authors by for climate-related articles and all other articles in economics",
       x = "Climate change related articles vs the rest",
       y = "Mean Proportion",
       fill = "Gender") +
  scale_y_continuous(limits = c(0, 1)) +
  theme_minimal()
```

Analysis of the data on articles relating to climate change, grouped according to the binary variable "CC" (climate change), reveals notable differences in the gendered composition of authors. 
<!-- I'd say that there is not much differences "in average": the graph suggests no meanigful differences in the bar heights -->

Looking at the descriptive statistics, we see that in the category where the theme of climate change is central ("CC = 1"), the average proportion of female authors is slightly higher than in the "CC = 0" category.
In detail, the average proportion of female authors is 28.29% in the "CC = 1" category, compared with 25.53% in the "CC = 0" category.
On the other hand, the "CC = 0" category shows a greater predominance of male authors, with an average of 74.47%, compared to the "CC = 1" category where the average is 71.71%.


These results highlight a distinct gendered distribution in climate change-related publications, with a predominance of male authors in both categories but more female authors in articles that focus on climate change, thus indicating varied dynamics in gender participation depending on the specific research theme.

<!-- We need to bring nuance: When interpreting this: important to remind that articles focusing on climate change intiated in early 2000, at a time where inclusion of female authors was increasing. So, when comparing with the rest of economics, there is an important quantity of "old" articles, with very few female authors. Thus: we can't say whether the relatively higher share of female authors on climate-related article is linked to the topic -->

#### Climate change, category gender and number of articles

```{r, echo=FALSE, include=TRUE}
stats_by_CC_category_gender <- Corpus.CleanedNames.2 %>%
  group_by(CC, category_gender) %>%
  summarize(nb_articles = n(), .groups = 'drop')

# stats_by_CC_category_gender

# Calculer la proportion des articles pour chaque combinaison de CC et category_gender
stats_by_CC_category_gender <- stats_by_CC_category_gender %>%
  group_by(CC) %>%
  mutate(proportion_articles = nb_articles / sum(nb_articles))

# Graphique
ggplot(stats_by_CC_category_gender, aes(x = factor(CC), y = proportion_articles, fill = category_gender)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Proportion of Articles by Collaboration Type and Climate Change Relevance",
       x = "Climate Change Relevance (CC)",
       y = "Proportion of Articles",
       fill = "Collaboration Type") +
  theme_minimal()
```

Analysis of the data on the number of articles relating to climate change, represented by the binary variable "CC" (climate change) and the gender category, reveals some interesting trends in the distribution of publications.

Looking at the descriptive statistics, we observe a marked disparity in the number of articles published according to gender category and type of scientific research.
In the "CC = 0" category (not focused on climate change), the distribution of articles by gender is significantly different from that observed in the "CC = 1" category (focused on climate change).

For the "CC = 0" category, which does not deal specifically with climate change, the data show a significant predominance of articles attributed to the masculine (296,893 articles) and feminine (86,249 articles) genders, followed by mixed gender combinations (167,934 articles for MF, 188,404 articles for MM).
In contrast, the "CC = 1" category shows lower overall articles numbers, with a similar trend of male predominance, but with a slightly higher proportion of items attributed to mixed gender combinations (8,310 articles for MF, 7,149 articles for MM).
Analysis of the number of articles by genre category therefore reveals that, despite the lower overall quantity of articles in the "CC = 1" category, mixed-genre combinations account for a significant share compared with the other categories, underlining an increased diversity in scientific collaborations focused on climate change.

<!-- Most of these differences are explained by the fact that the climate economics literature is rather recent (explosion starting in 2005). The difference in the representaion of categories between CC articles and the rest of economics, is thus clearly due to this characteristic. One way to limit this would be to compare these figures for a subsample of articles in 2005-2020. I think that your graph below is interesting: it shows no difference in the share of female authors between the two literatures -->

### Temporal evolution of the proportion of female authors by CC

```{r, echo=FALSE, include=TRUE}
annual_stats_by_CC <- Corpus.CleanedNames.2 %>%
  group_by(PY, CC) %>%
  summarize(
    Mean_Proportion_Female_Id = mean(proportion_gender_female_id, na.rm = TRUE),
    .groups = 'drop'
  )  #%>% 
  # complete(PY, Mean_Proportion_Female_Id, fill = list(n = 0))

ggplot(annual_stats_by_CC, aes(x = PY, y = Mean_Proportion_Female_Id, color = factor(CC))) +
  geom_line(size = 1) +
  labs(title = "Evolution of Mean Proportion of Female Authors Over Time",
       x = "Publication Year",
       y = "Mean Proportion of Female Authors",
       color = "Climate Change Relevance (CC)") +
  theme_minimal() +
  scale_y_continuous(limits = c(0, 1)) # Ajuster les limites de l'ordonnée pour aller de 0 à 1
```

This section provides descriptive statistics and an analysis of the time trend in the proportion of authors identified as "women", for articles dealing with climate change ("CC" = 1) compared with articles not dealing with climate change (CC = 0).
Analysis of the results shows an upward trend in the proportion of women in both categories.
For example, in 1983, the proportion of women authors was 13.5%, whereas it was 30.1% in 2017.
For articles on climate change, the proportion was 0.4% in 1989, compared with 23% in 2023.
The increase in the proportion of women is therefore more marked in climate economics research than in other types of economic research.

<!-- This figure exactly suggests that climate-related articles are recent, and thus have in average a composition of gendered-authorship which looks like to the recent composition in the rest of economics, and is different from the old type of authors (before 2000). -->

###.Focus on Top5 and Top30 journals and on climte change

```{r, echo=FALSE, include=FALSE}
# Calculer les statistiques descriptives pour chaque combinaison de catégorie de journaux et de la variable binaire "CC"
stats_by_top5journal_CC <- Corpus.CleanedNames.2 %>%
  group_by(TopFive, CC) %>%
  summarize(
    Mean_Proportion_Female_Id = mean(proportion_gender_female_id, na.rm = TRUE),
    Median_Proportion_Female_Id = median(proportion_gender_female_id, na.rm = TRUE),
    Median_Proportion_Male_Id = median(proportion_gender_male_id, na.rm = TRUE),
    Mean_Proportion_Male_Id = mean(proportion_gender_male_id, na.rm = TRUE),
  )
```

```{r, echo=FALSE, include=FALSE}
# Calculer les statistiques descriptives pour chaque combinaison de catégorie de journaux et de la variable binaire "CC"
stats_by_top30journal_CC <- Corpus.CleanedNames.2 %>%
  group_by(Top30, CC) %>%
  summarize(
    Mean_Proportion_Female_Id = mean(proportion_gender_female_id, na.rm = TRUE),
    Median_Proportion_Female_Id = median(proportion_gender_female_id, na.rm = TRUE),
    Median_Proportion_Male_Id = median(proportion_gender_male_id, na.rm = TRUE),
    Mean_Proportion_Male_Id = mean(proportion_gender_male_id, na.rm = TRUE),
  )
```

This section provides descriptive statistics on the proportion of women and men by journal type and research theme.
For articles not related to climate change (CC = 0), the average proportion of female authors is higher in Top 30 journals (26.05%) than in Top 5 journals (14.26%).
This suggests a more significant representation of female authors in the lower-quality newspapers for this type of article.

On the other hand, for articles on climate change (CC = 1), although the trend is similar, with a higher average proportion of female authors in Top 30 (13.80%) compared to Top 5 (12.41%), the gap is less marked than for articles not related to climate change.

```{r, echo=FALSE, include=TRUE}
ggplot(Corpus.CleanedNames.2, aes(x = factor(Top30), y = proportion_gender_female_id)) +
  geom_boxplot() +
  labs(title = "Proportion of Female Authors in Top 30 Journals",
       x = "Top 30 Journals",
       y = "Mean Proportion of Female Authors") +
  facet_wrap(~ CC, scales = "free")

ggplot(Corpus.CleanedNames.2, aes(x = factor(Top30), y =proportion_gender_male_id)) +
  geom_boxplot() +
  labs(title = "Proportion of Male Authors in Top 30 Journals",
       x = "Top 30 Journals",
       y = "Mean Proportion of Female Authors") +
  facet_wrap(~ CC, scales = "free")
```

Alternartive representation: I think that I would also represent the average share of female authors using bars, rather than the boxplot. Like this:

```{r}

# Conversion en format long
stats_bytop30_long <- stats_by_top30journal_CC %>%
  pivot_longer(cols = c(Mean_Proportion_Female_Id, Mean_Proportion_Male_Id),
               names_to = "Gender",
               values_to = "Proportion")



ggplot(stats_bytop30_long, aes(x = factor(Top30), y = Proportion, fill = Gender)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Proportion of the share of Female and Male Authors for climate-related articles and between top-30 journals and other journals",
       x = "Top-30 journals (=1) and other journals (=0)",
       y = "Mean Proportion",
       fill = "Gender") +
  facet_grid(~ CC, labeller = labeller(CC = c("1" = "Climate-related articles", "0" = "All articles in economics (except climate-related)")))+
  scale_y_continuous(limits = c(0, 1)) +
  theme_minimal()
```


# Modèle économétrique de citations

Construire un modèle qui permet de déterminer s'il existe un effet de l'autorat féminin sur les citations des articles de recherches.
Il est également possible de saisir le rôle du changement climatique (est-ce que les articles associés au changement climatiques sont plus cités que le reste des articles en économie?).

(i) explorer les données de citations: plusieurs variables existent (regarder le dictionnaire de variables, je crois qu'il y en a au moins 3). Regarder le degré de corrélation entre toutes ces mesures de citation, regarder également les valeurs manquantes afin de choisir laquelle des variables de citation choisir.

-   CR (Cited References) et NR (Cited References Count): ne sont plus dans la base de données, pourtant il s'agit je pense de variables importantes

<!-- En effet, mais elles ne nous seront pas utile dans l'immédiat (elles renseignent la bilbiographie de chaque article, et le nombre de références bibliographiques). Ici: nous étudions les déterminants des ciations reçues par un article: et on questionne le rôle du genre de l'auteur/des auteurs. -->

-   TC : Web of Sciences Core Collection Times Cited Count.

```{r}
na_TC <- sum(is.na(Corpus.CleanedNames.2$TC))
print(na_TC)
```

8020 valeurs manquantes sur 1 136 055 soit seulement 0.7%.

-   Z9 : Total Times Cited Count

```{r}
na_Z9 <- sum(is.na(Corpus.CleanedNames.2$Z9))
print(na_Z9)
```

460 866 valeurs manquantes sur 1 136 055 soit 40.5%

-   U1 et U2 peuvent être des variables intéressantes mais je ne comprends pas vraiment à quoi elles font référence.U2 citations entre 2013 et 2023

<!-- U2: nombres de citations reçues par l'article sur les 10 dernières années. U1: Nombre de citations sur les 6 derniers mois (mesuré en mars 2023) -->

```{r}
na_U1 <- sum(is.na(Corpus.CleanedNames.2$U1))
print(na_U1)
```

460 865 valeurs manquantes sur 1 136 055 soit 40.5%

```{r}
na_U2 <- sum(is.na(Corpus.CleanedNames.2$U2))
print(na_U2)
```

460866 valeurs manquantes sur 1 136 055 soit 40.5%

Mêmes chiffres pour U1,U2 et Z9 donc il s'agit peut-être des mêmes articles à chaque fois dont les valeurs sont manquantes pour ces 3 variables.
TC semble être la meilleure variable à utiliser étant donné son faible nombre de donnnées manquantes.

<!-- Les valeurs manquantes de z9, u1 et u2 viennent du fait que seuls les articles de web of science disposent de ces variablees. Les articles de Scopus ne disposent que de TC. On va donc utiliser TC comme variable dépendante. -->

(ii) Lire les deux articles déposés sur la dropbox ([cliquer ici pour le lien](https://www.dropbox.com/scl/fo/jxx20i4cdgd4xnfhfm0na/ADxj_2rn9GVec03RiifhawA?rlkey=p8ps1t61v9jo9kan339uyv94c&dl=0)). L'article de Nature est très descriptif et possiblement en décalage (la question des premiers auteurs ne se posent pas en économie, car l'ordre des auteurs est quasi systématiquement l'ordre alphabétique). L'article dans la revue de sciences sociale est vraiment pas mal pour situer la question, et voir une approche (l'article fait aussi une bonne revue de litté qui peut être utile si tu cherches d'autres méthodes/références pour t'inspirer).

### Global gender disparities in science (R. Sugimoto) = global and cross-disciplinary analysis of gender inequalties in research output

##### Constats:

-   Differences in productivity: men publish more papers than women, especially in areas in which research is expensive.
-   Citations: Women are more cited especially in fields with greater career risks such as ecology.

##### Methodology:

-   Analysis of the relationship between gender and research output (proxy = authorship on published papers);

-   Analysis of the extent of collaboration (proxy = co-authorships);

-   Analysis of **scientific impact** of articles published between 2008 and 2012 indexed in Web of Science databases (**proxy = citations**).

-   Observations: 5,483,841 research papers and review articles with 27,329,915 authorships.

-   Gender assignment: using data from the US Social Security database
<!-- I guess that this is, in some parts, a similar gender identification protocole as ours? The gender package uses US social security data on firstname and the  gender of each US citizen.  -->

-   Proportion of each gender's output by comparing the proportion of identified authorships for each gender on any given paper.These gendered fractions were then aggregated at the levels of countries and disciplines.

##### Results:

-   Women account for fewer than 30% of fractionalized authorships.

-   Geographical disparities: research output is dominated by male authors in nearly every country.
    Communists states have greater gender parity.
    Countries with lower research output concentrate female dominance.
    South American and Eastern European countries demonstrate greater gender parity.

-   In the most productive countries, all articles with women in dominant author positions receive fewer citations than those with men in the same positions

-   Women profit less from the extra citations that international collaborations accrue.

-   Women publish more in fields related to "care" whereas men publish more in fields related to economics or high-energy physics.

-   Collaboration: Women are less likely to participate in collaborations that lead to publication as well as international collaborations: female collaborations are more domestically oriented than are the collaborations of males from the same country.

##### Limits

-   Age which could play a crucial role in explaining gender differences in scientific output

-   The analysis of first authors insofar as authors are listed alphabetically.

### A rare case of Gender Parity in Academia (B.Lynn, C.Noonan, M.Sauder)

**Context:** The study explores the gender gap in academic citations, focusing on the reasons behind the *absence of a significant gender gap in this specific context* **and** controlling for citations predictors.\

Citation information has played an increasingly explicit role in the way that scholars and administrative bodies measure "research achievement" + the fact of attracting their peers.

**Analysis:** Estimate the effect of author gender on citations.Questions:

-   To what extent do female- and male-led publications exhibit similar characteristics in terms of citation predictors?

-   Do comparable male- and female-led publications attract a comparable number of citations?

-   How important is author gender overall relative to other citation predictors?

Reasons of this analysis:

-   Gender could be significantly correlated with one of the abovementioned citation predictors, such as producer expertize, authority, or visibility.

-   Audience could discriminate directly on the basis on author gender when allocating citations, in which case author gender would predict citation counts even if publications were otherwise comparable

##### Other interesting bibliography

Aksnes et al. (2011) - Research area = Biology and environmental sciences.
Results = Female penalty

##### Methodology

**Data Sample**: Analysis of approximately 10,000 publications across economics, political science, sociology and regional journals.

**Citation counts** = number of citations accruing to each focal article (as indexed by WoS) from the publication date through December 2013.
Citation trajectories thus range from 10 to 30 years, depending on when the article was published.\

Sales-Pardo, and Amaral (2010) argue that for the vast majority of journals, publications generally accumulate the bulk of their citations within roughly ten years of publication.
They thus recommend that citation studies focus on publication cohorts that are **at least a decade old**.

**Citation predictors**

The nu**mber of citations can be shaped by characteristics** = **citation predictors : the product (the article,** **the** **journal), the producers (the popularity** **of** **authors,** **marketing), market** **size** **and the *audience* (scholarly peers, the field /** discrimination)\

-   Market size proxies:

    First proxy = subfields = they classify each referenced journal by its field according to Journal Citation Reports (JCR).\

    Second proxy = the "uniqueness" of the work cited in the focal article regarding the sources cited.
    They expect that this variable is negatively correlated with total citation counts, as too many unconventional sources could indicate that the article (a) focuses on a non-conventional topic (and thus has a smaller audience) or (b) is perceived by the audience as unpersuasive.

-   Producer Expertize, Authority and Visibility\
    Median publication year of all references: negatively correlated with citations received

    Proportion of References to Unpublished Sources in the Focal Article divided by the total number of references: positively correlated with citations received

    Focal Author(s) Institutional Prestige: author's institutional affiliation at the time of publication matched with the 1990 National Research Council's departmental prestige rankings: positively correlated with citations received.

    Focal Author(s) Flagship Journal Appearances: the number of times a researcher publishes in his/her discipline's top journals is used as a proxy for scholarly visibility and expertize: positively correlated with citations received.

    Presence of Self-Citation: proxy for self-promotion.
    Self-citation is measured as the presence of at least one self-citation in the focal article.

-   Control Variables: article type, articles are either single or multipled authors, number of pages and number of references

##### Results:

-   OLS results = no significant gender gap in terms of the **number** of logged citations.
    When male and female authors publish articles that are comparably positioned to receive citations, their publications accrue citations at the same rate.

-   Results of predictors: the estimated effects of the other citation predictors are generally in the expected direction

-   It highlights two mechanisms: commitment bias and self-selection, which are often activated in other professional outcomes but seem irrelevant or muted in the case of citations.

iii) Il va falloir ensuite faire des modèles économétriques et diagnostiquer les résultats. Il ya plusieurs points qui vont être problématique: beaucoup d'articles avec 0 citation, beaucoup de journaux avec peu d'articles. Une solution possible est de ne garder qu'un sous échantillon de journaux stable sur tout l'échantillon. Il y aura alors des allers retours récurrents entre une spécification économétrique, une interprétation de résultat, puis une modification de l'échantillon ou du modèle pour aboutir à quelques choses qui semble satisfaisant.

L'idée est de viser un modèle de ce type:

\$C\_{i,j,t} = \alpha\_0 + \delta\_j + \mu\_t + \beta F_i + \gamma\*1\* \times NAUTH{i} + \gamma\*k X_k +\* \varepsilon{i,j,t} \$

\- $C_{i,j,t}$ sont les citations reçues par l'article i publié dans le journal $j$ à l'année $t$ = TC

-alpha_0 = constante\
- $\delta_j$ un effet fixe journal = TI

\- $\mu_t$ un effet fixe année (sinon, possible d'estimer sans effet fixe année, mais en mesurant les citations divisés par l'âge de l'article = une mesure du nombre moyen de citations reçues par l'article chaque année depuis sa publication) = PY

\- $F_i$ la variable mesurant la part d'autorat féminin (ou bien à combiner avec n'importe quel autre variable d'intérêt, les articles qui traitent du changement climatique, les différentes combinaisons de genre de collaborations) = proportion_gender_female_id / CC

\- puis intégrer des variables de contrôle = nombre de journaux = PG / nombre auteurs = nb_authors

-\> ne pas s'inquiéter si les résultats ne sont pas significatifs.
D'après un rapide regard, cela semble normal d'après la littérature de ne pas remarquer une différence moyenne de citation selon le genre.
L'idée est surtout de tester différents modèles et de les comparer.

Une ressource possiblement utile: Le cours d'économétrie de Sciences Po en ligne(cliquer ici)\[https://scpoecon.github.io/ScPoEconometrics/panel-data.html\].
Avec pas mal de commandes de base sur R, il est plutot bien fait pour s'introduire à l'économétrie.
JE pense que c'est une bonne première base.
Si tu veux aller plus loin, dis moi et je peux te filer d'autres manuels ou supports.
Tu peux essayer d'appliquer leur exercice d'analyse du crime dans les comtés américains par année.
Ici nous c'est l'analyse du genre dans les journaux d'économie et par année.
Je pense qu'il faut voir le journal/la revue comme l'équivalent du comté, et ensuite chaque article est comme un crime (avec dans notre cas des caractéristiques dont on cherche à évaluer le rôle: dont notamment le genre des auteurs.) Les modèles que l'on cherche à faire sont ceux de la "dummy variable regression" ou aussi de la "within transformation" (sur le site web).
Qui sont deux approches parfaitement équivalentes (eles donnent les mêmes coefficient pour le $\beta$ associé à la variable F).



```{r,include=FALSE}

# A pdata frame, to use plm commands
Corpus_pdata <- Corpus.CleanedNames.2 %>% 
  filter(!is.na(PY)) %>% 
  pdata.frame(index = c("SO","PY")) %>% 
  mutate(TC = as.numeric(TC),
         PG = as.numeric(PG))

# A standard dataframe, with fixed effect in factor, to use lm commands, just to check and compare with plm commands (should lead to the same results)
Corpus_data <- Corpus.CleanedNames.2 %>% 
  filter(!is.na(PY)) %>% 
  mutate(PY = as.factor(PY),    # Effet fixe année=PY
         SO = as.factor(SO), # Effet fixe journal
         TC = as.numeric(TC),
         PG = as.numeric(PG)
  )

# Only keep articles published in journals with at least 100 publications
Corpus_pdata <- Corpus_pdata %>% 
  group_by(SO) %>% 
  mutate(N_SO = n()) %>% 
  arrange(SO) %>% 
  filter(N_SO > 200) %>% 
  ungroup() %>% 
  select(TC, PY, SO, proportion_gender_female_id, PG, nb_authors, Top30, TopFive, Top25, CC, category_gender, AtLeastOneMale, AtLeastOneFemale)
Corpus_data <- Corpus_data %>% 
  group_by(SO) %>% 
  mutate(N_SO = n()) %>% 
  arrange(SO) %>% 
  filter(N_SO > 200) %>% 
  ungroup()%>% 
  select(TC, PY, SO, proportion_gender_female_id, PG, nb_authors, Top30, TopFive, Top25, CC, category_gender, AtLeastOneMale, AtLeastOneFemale)
# Remove about 200 000 articles that are published in not recuring journals  
```


We are going to estimate a fixed effect panel model: a journal-fixed effect, and a year fixed efffect, and our variable measuring the share of female authors at the article level. We will thus compare the share of citation received by an article published in a given year in a given journal, with an article in the same journal-year, and the only difference will be the share of female-authors.

```{r, include=FALSE}
levels_count1 <- Corpus_data %>%
  summarise(PY_levels = n_distinct(PY),
            SO_levels = n_distinct(SO))

print(levels_count1)
```

74 années différentes et 10 125 journaux différents.
<!-- Removing articles publlished in journals with less than 100 articles, we then have 1394 different journals -->


Citations et nombre de pages en numérique

Régression des citations sur l'effet fixe année, l'effet fixe journal, la proportion d'auteurs identifiées comme femme, avec comme variables de contrôle le nombre d'auteurs et de page par article

```{r}
library(fixest)
model_pooled <- feols(fml = TC ~ proportion_gender_female_id + PG + nb_authors, data = Corpus_data) # No fixed effects
model_jfe <- feols(fml = TC ~ proportion_gender_female_id + PG + nb_authors | SO, data = Corpus_data) # Journal fixed effects
model_yfe <- feols(fml = TC ~ proportion_gender_female_id + PG + nb_authors | PY, data = Corpus_data) # Year fixed effects
model_twfe <- feols(fml = TC ~ proportion_gender_female_id + PG + nb_authors | SO + PY, data = Corpus_data) # Year and journal fixed effects
model_twfe2 <- feols(fml = TC ~ proportion_gender_female_id + PG + nb_authors | PY^SO, data = Corpus_data) # Year and journal fixed effects

df_models <- etable(list(model_pooled, model_jfe, model_yfe, model_twfe, model_twfe2), tex=FALSE)
kableExtra::kbl(x = df_models, format = "html")
```

<!-- Il faudrait réviser les interprétations:
- En particulier: évolution du coef lié à la part des femmes: prendre en compte le journal (à travers un effet fixe) réduit l'effet des variables nb d'auteurs et part de femmes auteurs. Prendre en compte le journal et l'année de publication réduit encore plus l'effet de la variable mesurant la part des femmes auteurs, au point qu'elle n'est plus statistiquement significative. Cas d'un effet fixe journal-année (effet journal et année spécifique: on compare les citations relativement aux articles publiés dans le même journal et la même année): effet négatif et significatif. -->

Interprétation coefficients:
- Proportion de Femmes parmi les Auteurs (Estimate = 3.09736, SE = 0.77091)
La proportion de femmes parmi les auteurs a un effet positif et significatif sur le nombre de citations. Une augmentation de 1 unité dans la proportion de femmes est associée à une augmentation de 3.10 citations (p < 0.001)
- Nombre de Pages par Article (Estimate = 0.01771, SE = 0.01248)
Le nombre de pages par article a un effet positif mais non significatif sur le nombre de citations (p > 0.05). Chaque page supplémentaire est associée à une augmentation de 0.018 citations.
- Nombre d'Auteurs par Article (Estimate = 0.79084, SE = 0.23708)
Le nombre d'auteurs a un effet positif et significatif sur le nombre de citations (p < 0.01). Chaque auteur supplémentaire est associé à une augmentation de 0.79 citations.

### Dummy Variable Regression

```{r}
# Plus utile (il s'agit d'un modèle de panel, avec effet fixe année et effet fixe journal (équivalent à model_twfe), pas utile de le réestimer, surtout que cela prend beaucoup de temps)
# model = list()
# model$dummy <- lm(TC ~ proportion_gender_female_id + PG + nb_authors + factor(SO)+ factor(PY), data = sample_data)
# model$dummy$coefficients[names(model$dummy$coefficients) %in% c("proportion_gender_female_id", "PG", "nb_authors")]

# summary(model$dummy)
# stargazer(model$dummy, 
#           type = "text",
#           keep = c(1,2,3)
#           )
```

Interprétation coefficients = très similaire à la régression précédente:
- Proportion de Femmes parmi les Auteurs:Estimate: 3.0974/Std. Error: 0.7709
Très significatif (p < 0.001). Cela suggère qu'une augmentation de la proportion d'auteurs féminins identifiés est associée à une augmentation du nombre de citations de l'article.Pour chaque augmentation de 1 unité (ou 100%) dans la proportion d'auteurs identifiés comme femme, le nombre de citations (TC) augmente en moyenne de 3.0974 citations.
- Nombre de Pages par Article.Estimate: 0.0177/Std. Error: 0.0125
Pour chaque page supplémentaire, le nombre de citations (TC) augmente en moyenne de 0.0177 citations. Cependant, cette relation n'est pas statistiquement significative.
- Nombre d'Auteurs par Article:Estimate: 0.7908/Std. Error: 0.2371
Très significatif (p < 0.001). Cela suggère qu'un nombre plus élevé d'auteurs est associé à un nombre plus élevé de citations de l'article.Pour chaque auteur supplémentaire, le nombre de citations (TC) augmente en moyenne de 0.7908 citations.

### The Within Transformation

```{r}
# Pas utile de le réestimer: c'estun modèle à effets fixes identiques à ceux estimer plus haut, seulement on change la méthode d'estimation. Au lieu d'inclure les variables binaires propres à chaque effets fixes dans la régression, on régresse les variables centrées sur la moyenne de l'année et du journal
# sample_data2 <- sample_data %>%
#   group_by(SO) %>%
#   mutate(mean_TC = mean(TC, na.rm=T),
#          mean_prop = mean(proportion_gender_female_id, na.rm=T),
#          mean_PG = mean(PG, na.rm=T),
#          mean_nb_authors = mean(nb_authors, na.rm=T)) %>%
#   ungroup() %>%
#   group_by(PY) %>% 
#     mutate(mean_PY_TC = mean(TC, na.rm=T),
#          mean_PY_prop = mean(proportion_gender_female_id, na.rm=T),
#          mean_PY_PG = mean(PG, na.rm=T),
#          mean_PY_nb_authors = mean(nb_authors, na.rm=T)) %>%
#   ungroup() %>% 
#   mutate(demeaned_TC = TC - mean_TC - mean_PY_TC + mean(TC, na.rm=T),
#          demeaned_prop = proportion_gender_female_id - mean_prop - mean_PY_prop + mean(proportion_gender_female_id, na.rm = T),
#          demeaned_PG = PG - mean_PG - mean_PY_PG + mean(PG, na.rm=T),
#          demeaned_nb_authors = nb_authors - mean_nb_authors - mean_PY_nb_authors + mean(nb_authors, na.rm=T)
#          )
# model$xsect <- lm(TC ~ proportion_gender_female_id + PG + nb_authors, data = sample_data2)
# model$demeaned <- lm(demeaned_TC ~ demeaned_prop + demeaned_PG + demeaned_nb_authors, data = sample_data2)
# 
# stargazer(model$xsect, 
#           type = "text",
#           keep = c(1,2,3)
#           )
# stargazer(model$demeaned, 
#           type = "text",
#           keep = c(1,2,3)
#           )
# stargazer(model$dummy, 
#           type = "text",
#           keep = c(1,2,3)
#           )
# 
# summary(model$demeaned)
```

proportion_gender_female_id : Le coefficient estimé est positif mais non significatif = 0.23555 avec un écart type de 0.84075 donc la proportion d'auteurs identifiés comme femmes a un effet significatif sur le nombre de citations.

PG (nombre de pages) : Le coefficient est de 0.03115 avec un écart type de 0.01327. Ce coefficient est significatif au niveau de 5% (p = 0.0189) donc une augmentation du nombre de pages est associée à une augmentation du nombre de citations.

nb_authors (nombre d'auteurs) : Le coefficient est de -0.59259 avec un écart type de 0.24722. Ce coefficient est significatif au niveau de 5% (p = 0.0166) donc une augmentation du nombre d'auteurs est associée à une légère diminution du nombre de citations.

```{r}
# summary(model$demeaned)
```

Aucun résultat significatif

### Nouvelle méthode: plm
<!-- J'ai abandonné la méthode plm car méthode de calcul trop longue. Je pense que choisir la méthode du package fixest est très bien -->

```{r, include=FALSE}
# incomplete_rows <- is.na(sample_data$PY)
# sample_data_clean <- sample_data
#[!incomplete_rows, ]

# Transformons data 1 en un objet `panel data frame`
# sample_data_panel <- pdata.frame(sample_data_clean, index = c("SO", "PY"))# index spécifie la structure de panel de nos données: elles sont indicées par journaux avec la variable SO, et par le temps avec la variable PY

# Jetons un oeil à l'objet:
# pdim(sample_data_panel)
# head(index(sample_data_panel))
```

Effectuons la régression à l'aide de la commande plm, sans effet fixe

```{r, include=FALSE}
# model_plm = plm(formula = TC ~ proportion_gender_female_id + PG + nb_authors, # Formule du modèle estimé 
#                        data = sample_data_panel, 
#                        model = "within")
# stargazer(model_plm, type = "text")
# stargazer(model$dummy, type = "text", keep = c(1,2,3))
# stargazer(model$demeaned, type = "text", keep = c(1,2,3))
# coef(model_plm) # résumé des beta_chapeau,
# head(fixef(model_plm))
```

```{r, include=FALSE}
# model_lsdv = lm(formula = TC ~ proportion_gender_female_id + PG + nb_authors + factor(PY) + factor(SO),
                    # data = sample_data) # commande lm: on précise le modèle que l'on estime. En incorporant factor(fips) on force lm à comprendre les modalités de la variables fips comme étant chacune une variable binaire dans le modèle (moyen rapide d'incorporer des variables binaires). 
# head(coef(model_lsdv)) # Pour seulement obtenir les coefficients estimés par les MCO

# summary(est_model_lsdv) # Pour avoir le résumé entier de la régression (mais très long)
```

Les coefficients et même le signe des coefficients n'est pas le même suivant les deux méthodes...

To do list:
Analyse descriptive des données
Creuser les différences entre régression (Loic) 
Visualisation/représentation (Loic)
Sous-échantillon des journaux
TC/Age sans effet fixe

- A priori, les différences de régression venaient de la difficulté à estimer en intégrant des effets fixes doubles "manuellement" (surtout dans le cas de la méthode within: risque d'erreur de calculs lorsque l'on retire la moyenne), et estimation rendu délicate par le grand nombre d'observations (quasi 1 millions, en fait 610 000 lorsque l'on ne prend que les observations sans valeur manquantes pour la variable gender) et le grand nombre d'effets fixes (quasi plus de 1000).

- Représentation dans un tableau de régression des résultats de régression du package `fixest` avec la commande kbl du package `kableextra` semble idéale.

- En utilisant la méthode d'estimation de modèles à effets fixes du package `fixest`, il reste alors à étudier deux modèles:  
* Celui où l'on estime des modèles séparés sur le sous-échantillon des journaux du TOP30 (`Corpus_data` des articles publiés dans les journaux du TOP30), et le sous échantillon des autres journaux (`Corpus_data` en retirant les articles publiés dans des journaux du top 30), 
* Un second modèle où l'on étudie la caractère différencié des articles sur le changement climatique en terme de citation (intégré la variable CC, posible de la faire interagir avec le genre également).

## Analyse par pays

<!-- To do: -->
<!-- Gérer la sortie de l'algorithme pour faciliter l'aggrégation -->
<!-- Envisager les multiples orthographes des noms de pays -->
<!-- Pouvoir regrouper par région du monde -->

<!-- Nous avons la colonne des affiliations d'auteur C1. -->
<!-- Cette colonne a différents formats possibles, elle dit pour chaque auteur son (ses) affiliations (un auteur peut avoir plusieurs affiliations, et deux auteurs peuvent avoir la même affiliation). -->
<!-- L'objectif est donc de créer des variables qui retournent tous les pays cités dans cette colonne C1 et qui viendrait alors caractériser l'origine géographique de l'article. -->
<!-- Par étapes: 1. -->
<!-- Avoir un vecteur qui contient tous les noms de pays du monde. -->
<!-- 2. -->
<!-- Construire une commande qui regarde dans chaque élément de C1 quels pays apparaissent et retourne chacun de ces pays. -->
<!-- 3. -->
<!-- Puis faire des variables pour tous les pays cités par article (comme le nombre d'auteurs, on peut s'arréter à max 10 pays). -->

First, we create a vector containing each countries and their alternative orthograph/spelling. 


```{r, include=FALSE}

temp <- countries::country_reference_list %>% 
  filter(UN_en!="") %>%  # Retain countries reckognized by the UN
  as.data.frame() # Extract all country names 
name_columns <- c(grep("^name", names(temp), value = TRUE), "Name0", "Name1", "Name2", "WTO_en", "simple") # Select all columns for the different names/spellings
concatenate_non_blank <- function(row) {# Function to concatenate all orthographs in a single element, and discarding NA and blank space
  # Filter out blank spaces
  non_blank_values <- row[(row != "") & !is.na(row)]
  # Concatenate the non-blank values with "|"
  paste(non_blank_values, collapse = "|")
} 
concatenated_values <- apply(temp[,name_columns], 1, concatenate_non_blank) # Apply the function to each row of the UN countries
country_named_vector <- setNames(concatenated_values, temp$Name0) # Get a named vector, where each element is a country with all its orthographs separated by "|".
country_named_vector["United Kingdom"] <- paste(country_named_vector["United Kingdom"], "England|england|Scotland|scotland|Wales|wales|Northern Ireland", sep = "|")

```

We get the following list of spelling, for instance, in the case of the United States of America:

```{r}
country_named_vector[c("United States of America")]
```


Then, create a function that can detect if a country name appears in the affiliation column `C1`. We get as an outcome:

```{r, include=TRUE}

# Create subsample to test the function
sample_corpus <- Corpus.CleanedNames.2 %>% 
  filter(!is.na(C1)) %>% 
  slice_sample(n = 100)
C1_sample <- sample_corpus$C1

# Test function str_detect and str_extract
str_detect(string = sample_corpus$C1, pattern = country_named_vector[c("United States of America")]) # Returns T/F if country name appears
str_extract(string = sample_corpus$C1, pattern = country_named_vector[c("United States of America")]) # Return the exact string that match (the country name)

# Apply str_detect to the subsample of C1, and to all country names
tic()
Country_df <- as.list(country_named_vector) %>% # Take the vector of country names/spellings
  map_df(\(x) str_detect(string = str_to_title(sample_corpus$C1), pattern = x)) %>% # Apply the function str_detect to C1 on each element of the country named vector, and put the output in a dataframe with variable name being the name of the vector
  mutate(C1 = sample_corpus$C1) %>%  # Add to the data frame the affiliation to check
  select(C1, names(country_named_vector))
toc()

head(Country_df)

```

We can then add this to the `sample_corpus` data frame and have all the variables for all articles, and also their country of affiliation.

```{r}
sample_corpus_fin <- sample_corpus %>% 
  bind_cols(dplyr::select(Country_df, -C1))
head(sample_corpus_fin)
```


We can then summarize data by countries:



Que faire en suite?
1.
Décrire les données: part des articles/auteurs provenant de chaque pays du monde
```{r}

```








```{r}
df_country_counts <- data.frame(
  Country = names(formatted_counts),
  Count = as.numeric(formatted_counts)
)

# Création du graphique
ggplot(df_country_counts, aes(x = Country, y = Count)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(title = "Normalized Country Counts",
       x = "Country",
       y = "Normalized Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
# Définition des colonnes de pays
country_columns <- grep("^country_", colnames(sample_data_with_countries), value = TRUE)

# Fonction pour compter les occurrences de chaque pays par article
count_country_occurrences <- function(data, country_columns) {
  # Fonction interne pour compter les occurrences par article
  count_countries_in_article <- function(article_countries) {
    # Compter les occurrences de chaque pays
    counts <- table(unlist(article_countries))
    return(counts)
  }
  
  # Créer une nouvelle colonne pour les comptages de pays par article
  data$country_counts <- apply(data[, country_columns], 1, count_countries_in_article)
  
  return(data)
}

str_detect

# Appeler la fonction pour mettre à jour les données avec les comptages par pays
sample_data_with_countries <- count_country_occurrences(sample_data_with_countries, country_columns)
```

```{r}
# Remplacer les valeurs "integer(0)" par NA dans la colonne C1
# Remplacer les valeurs integer(0) par NA dans la colonne C1
# sample_data_with_countries$country_counts <- lapply(sample_data_with_countries$country_counts, function(x) {
#   if (length(x) == 0) {
#     return(NA)
#   } else {
#     return(x)
#   }
# })

# Convertir la liste en vecteur de caractères si nécessaire
# sample_data_with_countries$country_counts <- unlist(sample_data_with_countries$country_counts)
```



ou provenant de certaines régions du monde (US, vs EU, vs Reste du monde), évolution de ces parts par année.
PArt de l'origine géographique des auteurs selon les types de journaux.
Possible également de croiser genre et origine géographique.
Beaucoup de libertés ici dans la visualisation des données et l'interprétation 2.
Possible de faire des cartes pour visualiser les résultats (intensité des couleurs reflète la part d'articles provenant d'un pays/région).
3.
Construire des donées de panel qui contiennent pour chaque pays-année: le nombre d'articles traitant du changement climatique, puis un ensemble de variables économiques (PIB, part de budget public dans la recherche), et de variables indiquant l'exposition/l'implication face au changement climatique (émissions annuelles de GES, la mise en oeuvre d epolitique de réduction d'émissions, les possibles dégats futurs du changement climatique)... L'idée serait ensuite d'explorer les corrélations entre l'effort de recherche au sujet du changement climatique et ces variables.

```{r, include=FALSE}
# I archive old code below:
# extract_countries <- function(data, country_list){ #Fonction intitulée "extract_countries" qui prend comme argument la base de données et le vecteur qui contient la liste des pays du monde
#   
# 
#   result_matrix <- matrix(nrow = nrow(data), ncol = 10, 
#                           dimnames = list(NULL, paste0("country_", 1:10)))
#   #création d'une matrice vide dont le nombre de lignes correspond au nombre de lignes de la dataframe et dont le nombre de colonnes correspond au 10 pays representés par les colonnes "country_1" à "country_10". La commande dimnames spécifie le nom des lignes (pas de noms spécifiques =NULL) et le nom des colonnes
#   
#   # Loop through each entry in C1 column
#   
#   for (i in seq_along(data$C1)) 
#     
#     {
#     
#     potential_countries <- regmatches(data$C1[i], gregexpr("(?<=, )\\w+(?=(, |;|$))", data$C1[i], perl=TRUE))[[1]]
#   
#     
# #regmatches() est utilisé pour extraire les parties de data$C1[i] qui correspondent à l'expression régulière spécifiée par gregexpr().
# #gregexpr() recherche une expression régulière dans une chaîne de caractères donnée et retourne les positions des correspondances trouvées.
# #"(?<=, )\\w+(?=(, |;|$)) = séquences de caractères alphanumériques qui suivent une virgule et un espace, mais qui précèdent soit une virgule suivie d'un espace, un point-virgule ou la fin de la chaîne
#     
#     # Initialize counter for extracted countries
#     country_counter <- 1
#     
#     # Loop through potential countries
#     for (country in potential_countries) {
#       # Check if the extracted country is in country_list
#       if (country %in% country_list) {
#         # Store the country in the result matrix
#         result_matrix[i, country_counter] <- country
#         country_counter <- country_counter + 1
#         # Break if we've found 10 countries for this entry
#         if (country_counter > 10) break
#       }
#     }
#   }
#   
#   # Convert result_matrix to data frame and bind to original data
#   result_df <- as.data.frame(result_matrix)
#   data <- cbind(data, result_df)
#   
#   return(data)
# }

# sample_data_with_countries <- extract_countries(sample_data, country_list)

#sample_data_processed <- sample_data %>%
  #separate_wider_delim(
    #col = C1,
    #into = paste0("country_", 1:10), 
    #sep = "; ",
    #extra = "merge",
    #token = ", "
  #)


```


### Conclusion

In conclusion, this study provides a comprehensive quantitative analysis of gender disparities within the field of climate economics, focusing on authorship dynamics across different levels of journal prestige and types of collaborations.
Our findings underscore several key observations.
While strides have been made towards gender equality in academic authorship, persistent disparities necessitate ongoing efforts to promote diversity and inclusivity in research collaborations and methodologies.
Addressing these challenges is essential for advancing a more equitable and representative academic landscape in climate economics and beyond.

Firstly, our data analysis reveals persistent gender imbalances in academic publishing, with a notable underrepresentation of female authors across all categories.
While the average proportion of female authors is slightly higher in climate change-related articles compared to those not focused on climate change, both areas exhibit a predominantly male authorship landscape.
Secondly, our study highlights the impact of collaboration types on gender representation.
Mixed-gender collaborations (MF) demonstrate a more balanced distribution of authors, suggesting that fostering such collaborations could contribute to greater gender equity in academic research.
Moreover, our analysis of temporal trends reveals a gradual increase in the proportion of female authors over the decades, indicating positive albeit slow progress towards gender parity in academic publishing.
This trend is more pronounced in climate economics compared to broader economic research, reflecting evolving dynamics within specific research domains.
However, our study also identifies significant challenges in gender assignment methodologies, particularly in handling non-Western names, which remain a crucial limitation affecting the accuracy and inclusivity of gender analyses in academic research.
